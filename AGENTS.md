
This project is an R package that transpiles R functions to Fortran.

- To run the full test suite:
```sh
R -q -e 'devtools::test()'
```

- To run the full `R CMD check` locally (this takes a long time):
```sh
R -q -e 'rcmdcheck::rcmdcheck(error_on = "warning")'
```

- To run a single test file:
```sh
R -q -e 'devtools::test_active_file("tests/testthat/test-dims2f.R")'
```

- To run a subset of test files:
```sh
R -q -e 'devtools::test(filter = "regex")'
```
filter arg behavior: If not `NULL`, only tests with file names matching this regular expression will be executed. Matching is performed on the file name after it's stripped of "test-" and ".R".

- To run full coverage and save zero-coverage JSON output:
```sh
R -q -e 'covr::package_coverage() -> cov; saveRDS(cov, "cov.rds"); z <- covr::zero_coverage(cov); jsonlite::toJSON(z, pretty = TRUE)'
```

- To see the generated C and Fortran code for an R function, use `r2f()`:
```sh
R --no-save -q <<'EOF'
devtools::load_all()
r2f(function(x) {
  declare(type(x = double(NA)))
  x + 1
})
EOF
```

- When running tests and snapshots need to be updated, use this workflow:
  - `R -q -e 'testthat::set_max_fails(Inf); devtools::test(); testthat::snapshot_accept()'`
  - Afterwards always review diffs of updated snapshots to confirm they match expectations.

- Never disable or skip tests.

- When adding tests, strongly prefer tests that only excercise the public API (e.g. `expect_quick_identical()`); avoid asserting on generated Fortran/C translation strings unless explicitly asked. Avoid testing internal functions unless explicitly.

- When writing tests, make sure that we test both C/Fortran code generation (typically reported accuratly by covr), as well as calling the generated function (not covered by covr). Our tests must excercise the actual generated function.

- While troubleshooting and iterating towards a solution, you can run targeted single-file tests; After large refactors, always run the full test suite.

- Before opening a PR, always run `rcmdcheck`.

- Prefer extending S7 classes with explicit properties over attaching arbitrary unchecked attributes.

- README.md must only be generated by running:
```sh
R -q -e 'devtools::build_readme()'
```

- Before wrapping up, always run:
```sh
air format .
```
